<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Title -->
    
    <title>
        
            甜甜圈数学 from 2006 | 
        
        Blog
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Xiao Ye">
    <meta name="description" itemprop="description" content>
    <meta name="keywords" content=",math">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/Blog/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/Blog/img/favicon.png">
    <link rel="apple-touch-icon" href="/Blog/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Blog">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    
        
            <link rel="alternate" type="application/atom+xml" href="atom.xml">
        
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/Blog/css/material.min.css?rdUU9RcgLCpXgn+BEpYF7Q==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/Blog/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/Blog/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/Blog/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(/Blog/img/ns.jpg);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/Blog/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yexiaorain.github.io/Blog">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="甜甜圈数学 from 2006 | Blog">
    <meta property="og:image" content="http://yexiaorain.github.io/Blog/img/favicon.png">
    <meta property="og:description" content>
    <meta property="og:article:tag" content="math"> 

    
        <meta property="article:published_time" content="Fri Dec 31 2021 10:37:14 GMT+0800">
        <meta property="article:modified_time" content="Sun Jun 26 2022 23:43:44 GMT+0000">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="甜甜圈数学 from 2006 | Blog">
    <meta name="twitter:description" content>
    <meta name="twitter:image" content="http://yexiaorain.github.io/Blog/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="http://yexiaorain.github.io/Blog">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html">
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html",
    "headline": "甜甜圈数学 from 2006",
    "datePublished": "Fri Dec 31 2021 10:37:14 GMT+0800",
    "dateModified": "Sun Jun 26 2022 23:43:44 GMT+0000",
    "author": {
        "@type": "Person",
        "name": "Xiao Ye",
        "image": {
            "@type": "ImageObject",
            "url": "/img/satan.jpg"
        },
        "description": "阳光只洒在金碧辉煌的高楼上"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",math",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#本文尽量逐句翻译"><span class="post-toc-number">1.</span> <span class="post-toc-text">本文尽量逐句翻译</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码1"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">代码1</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码2"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">代码2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#原理"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3D物体-到-2D屏幕"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">3D物体 到 2D屏幕</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">代码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#去掉数学库"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">去掉数学库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CORDIC"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">CORDIC</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#去掉float"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">去掉float</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#总结"><span class="post-toc-number">2.</span> <span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Ref"><span class="post-toc-number">3.</span> <span class="post-toc-text">Ref</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 4 + 1);

    $('.post_thumbnail-random').attr('data-original', '/Blog/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                甜甜圈数学 from 2006
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/Blog/img/satan.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Xiao Ye</strong>
        <span>12月 31, 2021</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/Blog/tags/math/">math</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=甜甜圈数学 from 2006&url=http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html&pic=http://yexiaorain.github.io/Blog/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=甜甜圈数学 from 2006&url=http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html&via=Xiao Ye" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Blog&title=甜甜圈数学 from 2006&summary=&pics=http://yexiaorain.github.io/Blog/img/favicon.png&url=http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://yexiaorain.github.io/Blog/Blog/2021-12-31-donut/index.html&text=甜甜圈数学 from 2006" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="本文尽量逐句翻译"><a href="#本文尽量逐句翻译" class="headerlink" title="本文尽量逐句翻译"></a>本文尽量逐句翻译</h1><h2 id="代码1"><a href="#代码1" class="headerlink" title="代码1"></a>代码1</h2><p><code>donut.c</code>:</p>
<pre><code class="c">             k;double sin()
         ,cos();main(){float A=
       0,B=0,i,j,z[1760];char b[
     1760];printf(&quot;\x1b[2J&quot;);for(;;
  ){memset(b,32,1760);memset(z,0,7040)
  ;for(j=0;6.28&gt;j;j+=0.07)for(i=0;6.28
 &gt;i;i+=0.02){float c=sin(i),d=cos(j),e=
 sin(A),f=sin(j),g=cos(A),h=d+2,D=1/(c*
 h*e+f*g+5),l=cos      (i),m=cos(B),n=s\
in(B),t=c*h*g-f*        e;int x=40+30*D*
(l*h*m-t*n),y=            12+15*D*(l*h*n
+t*m),o=x+80*y,          N=8*((f*e-c*d*g
 )*m-c*d*e-f*g-l        *d*n);if(22&gt;y&amp;&amp;
 y&gt;0&amp;&amp;x&gt;0&amp;&amp;80&gt;x&amp;&amp;D&gt;z[o]){z[o]=D;;;b[o]=
 &quot;.,-~:;=!*#$@&quot;[N&gt;0?N:0];}}/*#****!!-*/
  printf(&quot;\x1b[H&quot;);for(k=0;1761&gt;k;k++)
   putchar(k%80?b[k]:10);A+=0.04;B+=
     0.02;}}/*****####*******!!=;:~
       ~::==!!!**********!!!==::-
         .,~~;;;========;;;:~-.
             ..,--------,*/
</code></pre>
<p><code>gcc -o donut donut.c -lm &amp;&amp; ./donut</code></p>
<p>这是作者第一次尝试混淆C代码, 这个版本是相对简单优雅的</p>
<h2 id="代码2"><a href="#代码2" class="headerlink" title="代码2"></a>代码2</h2><p><strong>注意</strong> 下面13行,因为我本地的hexo相关工具不能正确工作,为了尽可能展示代码,我在<code>&lt;</code>和<code>.</code>之间加了一个空格,实际上是没有空格的,所以如果从这里拷贝代码,记得去掉多出的空格</p>
<pre><code class="c">    _,x,y,o       ,N;char       b[1840]       ;p(n,c)
    {for(;n       --;x++)       c==10?y       +=80,x=
    o-1:x&gt;=       0?80&gt;x?       c!=&#39;~&#39;?       b[y+x]=
    c:0:0:0       ;}c(q,l       ,r,o,v)       char*l,
           *r;{for       (;q&gt;=0;       )q=(&quot;A&quot;       &quot;YLrZ^&quot;
           &quot;w^?EX&quot;           &quot;novne&quot;     &quot;bYV&quot;       &quot;dO}LE&quot;
           &quot;{yWlw&quot;      &quot;Jl_Ja|[ur]zovpu&quot;   &quot;&quot;       &quot;i]e|y&quot;
           &quot;ao_Be&quot;   &quot;osmIg}r]]r]m|wkZU}{O}&quot;         &quot;xys]]\
    x|ya|y&quot;        &quot;sm||{uel}|r{yIcsm||ya[{uE&quot;  &quot;{qY\
    w|gGor&quot;      &quot;VrVWioriI}Qac{{BIY[sXjjsVW]aM"  "T\
    tXjjss"     "sV_OUkRUlSiorVXp_qOM>E{BadB"[_/6  ]-
    62>>_++    %6&1?r[q]:l[q])-o;return q;}E(a){for (
           o= x=a,y=0,_=0;1095>_;)a= " < .,`'/)(\n-"  "\\_~"[
           c  (12,"!%*/')#3"  ""     "+-6,8","\"(.$" "01245"
           " &79",46)+14],  p(""       "#$%&'()0:439 "[ c(10
           , "&(*#,./1345" ,"')"       "+%-$02\"! ", 44)+12]
    -34,a);  }main(k){float     A=0,B= 0,i,j,z[1840];
    puts(""  "\x1b[2J");;;      for(;; ){float e=sin
    (A), n=  sin(B),g=cos(      A),m=  cos(B);for(k=
    0;1840>   k;k++)y=-10-k/    80   ,o=41+(k%80-40
           )* 1.3/y+n,N=A-100.0/y,b[k]=".#"[o+N&1],  z[k]=0;
           E(  80-(int)(9*B)%250);for(j=0;6.28>j;j   +=0.07)
           for  (i=0;6.28>i;i+=0.02){float c=sin(    i),  d=
           cos(  j),f=sin(j),h=d+2,D=15/(c*h*e+f     *g+5),l
    =cos(i)        ,t=c*h*g-f*e;x=40+2*D*(l*h*  m-t*n
    ),y=12+       D  *(l*h*n+t*m),o=x+80*y,N  =8*((f*
    e-c*d*g       )*m   -c*d*e-f*g-l*d*n)     ;if(D>z
    [o])z[o       ]=D,b[     o]=" ."          ".,,-+"
           "+=#$@"       [N>0?N:       0];;;;}       printf(
           "%c[H",       27);for       (k=1;18       *100+41
           >k;k++)       putchar       (k%80?b       [k]:10)
           ;;;;A+=       0.053;;       B+=0.03       ;;;;;}}
</code></pre>
<p>同样的编译和运行命令, 这次是有背景, 有弹幕的版本</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>2011 年,有人提起了作者的2006年的作品,有很多请求作者讲解原理的,但过去了5年,作者并不能清晰记得,所以作者打算从零开始,非常详尽的细节,希望能得到相近的结果</p>
<p>这个内容的核心是利用 帧buffer 和 Z-buffer 来渲染像素(通过ascii渲染低分辨率的图像)</p>
<p>通过固定的角度增量的,来绘制对应的环面(torus), 亮度是从暗到亮对应的<code>ASCII</code>是<code>.,-~:;=!*#$@</code>.(不需要射线追踪</p>
<h3 id="3D物体-到-2D屏幕"><a href="#3D物体-到-2D屏幕" class="headerlink" title="3D物体 到 2D屏幕"></a>3D物体 到 2D屏幕</h3><p><img src="https://www.a1k0n.net/img/perspective.png" alt="3D和2D映射"></p>
<p>如图, 当一个人看一个3D 物体时,眼睛和物体连线与屏幕的交点, 就是我们要的投影</p>
<p>把3D物品渲染到2D屏幕上</p>
<p>$(x,y,z)$实际的点投影到 距离眼睛为$z’$的屏幕的$(x’,y’)$上</p>
<p>显然相似三角形</p>
<p>$\frac{y’}{y}=\frac{x’}{x}=\frac{z’}{z}$</p>
<p>换句话说$(x’,y’) = (z’\frac{x}{z},z’\frac{y}{z})$, 左边是要求的,右边是三维空间中已知</p>
<p>其中呢,人到屏幕距离$z’$是常量, 这个常量变化相当于把屏幕推远或拉近,取决于你希望展示多少内容</p>
<hr>
<p>因为物体有深度,所以可能多个点对应到2D屏幕上同一个点,那我们需要一个记录每个我们绘制的点的z坐标,这样可以保证后面的点不会覆盖前面的点</p>
<p>在记录<code>z-buffer</code>同时,我们可以同时增加<code>1/z-buffer</code>.</p>
<ol>
<li><code>1/z</code> 表示无穷远</li>
<li>计算$x’,y’$时,可以直接乘<code>1/z</code>,比除两次代价小(?</li>
</ol>
<p>现在可以开始绘制 甜甜圈了(torus)</p>
<hr>
<p>torus 是一个旋转体, 一个方法是把2D的圆,绕着一个圆外的轴旋转, 下图是个示意的切面</p>
<p><img src="https://www.a1k0n.net/img/torusxsec.png" alt="圆绕轴旋转"></p>
<p>先谈圆, 一个半径$R_1$的圆,其圆心在$(R_2,0,0)$</p>
<p>那么圆上的点$(x,y,z) = (R_2,0,0) + (R_1 \cos \theta,R_1 \sin \theta,0)$</p>
<p>如果绕y轴旋转, 其y轴不变, 根据旋转矩阵为</p>
<p>$\left( \begin{matrix} R_2 + R_1 \cos \theta, &amp; R_1 \sin \theta, &amp; 0 \end{matrix} \right)<br>\cdot \left( \begin{matrix} \cos \phi &amp; 0 &amp; \sin \phi \\ 0 &amp; 1 &amp; 0 \\ -\sin \phi &amp; 0 &amp; \cos \phi \end{matrix} \right)$</p>
<p>$= \left( \begin{matrix} (R_2 + R_1 \cos \theta)\cos \phi, &amp; R_1 \sin \theta, &amp; -(R_2 + R_1 \cos \theta)\sin \phi \end{matrix} \right)$</p>
<p>如果你希望也绕 x轴转$A$,或者 z轴旋转$B$, 只需要多乘上对应的旋转矩阵就完了</p>
<p>$\left( \begin{matrix}<br>1 &amp; 0 &amp; 0 \\<br>0 &amp; \cos A &amp; \sin A \\<br>0 &amp; -\sin A &amp; \cos A \end{matrix} \right)<br>\cdot<br>\left( \begin{matrix}<br>\cos B &amp; \sin B &amp; 0 \\<br>-\sin B &amp; \cos B &amp; 0 \\<br>0 &amp; 0 &amp; 1 \end{matrix} \right)$</p>
<hr>
<p>但对于上面来说, 会发现它其实整个的旋转中心都是原点,而我们上面给出的3D到2D的投影,过原点的是屏幕而不是物品, 不过幸运的是,我们仅需要把物体沿着z轴平移,就可以让它不再在原点上</p>
<p>对此,我们 令$K_1 = z’$控制人屏之间的距离,$K_2 = $ 人到物体旋转中心的距离,</p>
<p>$(x’,y’) = (z’\frac{x}{z},z’\frac{y}{z}) = (\frac{K_1 x}{K_2+z},\frac{K_1 y}{K_2+z})$</p>
<p>其中,第二第三个式子中的z并不相同,第二个是描述的距离人的z,而第三个是距离旋转中心的z</p>
<hr>
<p>把上述的矩阵展开</p>
<p>$\left( \begin{matrix} x \\ y \\ z \end{matrix} \right) = \left( \begin{matrix} (R_2 + R_1 \cos \theta) (\cos B \cos \phi + \sin A \sin B \sin \phi) - R_1 \cos A \sin B \sin \theta \\ (R_2 + R_1 \cos \theta) (\cos \phi \sin B - \cos B \sin A \sin \phi) + R_1 \cos A \cos B \sin \theta \\  \cos A (R_2 + R_1 \cos \theta) \sin \phi + R_1 \sin A \sin \theta \end{matrix} \right) = \left( \begin{matrix} C_x(\cos B \cos \phi + \sin A \sin B \sin \phi) - C_y \cos A \sin B  \\ C_x(\cos \phi \sin B - \cos B \sin A \sin \phi) + C_y \cos A \cos B \\  C_x \cos A \sin \phi + C_y \sin A \end{matrix} \right)$</p>
<p>其中$C_x,C_y$ 表示绕轴旋转前,圆上的点</p>
<p>实际上和最开始代码中的乘法因子完全不同(留给读者展开,原来的代码也交换了A的sin和cos, 高效的旋转90度,所以估计原来推导有些不同,但都能用)</p>
<hr>
<p>现在呢,知道了像素放在哪里,但是还没有阴影的概念, (也有意义,如果把投影全部同色绘制,就可以当影子看</p>
<p>要计算照明, 我们需要知道平面上每一点的法向量</p>
<p>如果知道了法向量,再和光的方向点积,其中光的方向自定义, </p>
<p>接下来就是向量点级的绝对值越大,亮度越大,正负选一面为看不见(根据法向量方向不同)</p>
<p>如何求法向量呢, 首先注意到法向量和平面同时一起旋转的, 那么对于圆上的点的法向量</p>
<p>是 $(\cos \theta,\sin \theta, 0)$</p>
<p>剩下的无非是乘上旋转矩阵了</p>
<p>$\left( \begin{matrix} N_x, &amp; N_y, &amp; N_z \end{matrix} \right) = \left( \begin{matrix} \cos \theta, &amp;<br>\sin \theta, &amp; 0 \end{matrix} \right) \cdot \left( \begin{matrix} \cos \phi &amp; 0 &amp; \sin \phi \\ 0 &amp; 1 &amp; 0 \\ -\sin \phi &amp; 0 &amp; \cos \phi \end{matrix} \right) \cdot \left( \begin{matrix} 1 &amp; 0 &amp; 0 \\<br>0 &amp; \cos A &amp; \sin A \\ 0 &amp; -\sin A &amp; \cos A \end{matrix} \right) \cdot \left( \begin{matrix} \cos B &amp; \sin B &amp; 0 \\ -\sin B &amp; \cos B &amp; 0 \\ 0 &amp; 0 &amp; 1 \end{matrix} \right)$</p>
<p>光的方向,这里选择45度夹角的光$(0,1,-1)$ (这里不是单位向量,长度根号2)</p>
<p>$\begin{aligned} L &amp;= \left( \begin{matrix} N_x, &amp; N_y, &amp; N_z \end{matrix} \right) \cdot \left( \begin{matrix} 0, &amp; 1, &amp;  -1 \end{matrix} \right) \\  &amp;= \cos \phi \cos \theta \sin B - \cos A \cos \theta \sin \phi - \sin A \sin \theta +  \cos B ( \cos A \sin \theta - \cos \theta \sin A \sin \phi) \end{aligned}$</p>
<p>这样我们有了亮度</p>
<p>剩下的就是选择你希望的 $K_1$(眼睛屏幕距离, 缩放大小),$K_2$(眼睛物体距离),$R_1$ 切面圆形半径,$R_2$ 圆形中心到旋转轴距离</p>
<p>对于代码中,选取的是$R_1=1,R_2=2$</p>
<hr>
<p>综上</p>
<p>$(x,y,z)$ 由 两个半径,枚举旋转体角度,和绕x轴,z轴旋转 得到</p>
<p>$(x,y,z)$ 投影到$(\frac{K_1 x}{K_2+z},\frac{K_1 y}{K_2+z})$</p>
<p>亮度为$L$</p>
<p>我们有了伪代码</p>
<pre><code class="c++">const float theta_spacing = 0.07; // 旋转体切面的圆上的点弧度旋转
const float phi_spacing   = 0.02; // 旋转体绕轴每份旋转弧度

const float R1 = 1; // 旋转体切面圆半径
const float R2 = 2; // 旋转体切面圆心和旋转轴距离
const float K2 = 5; // 人和旋转体旋转中心的距离
// 基于屏幕大小计算 K1 
// 对于torus的边缘, 也就是距离旋转中心$R1+R2$
// 我们希望它能被展示到屏幕的 3/8,也就是整个展示到屏幕的6/8,上下左右留白1/8
// 根据3D和2D转换关系
// 屏幕宽度*3/8 = K1*(R1+R2)/(K2+0)
const float K1 = screen_width*K2*3/(8*(R1+R2));

render_frame(float A, float B) { // A,B就是上面的旋转角度
  // 预计算 A,B的sin和cos
  float cosA = cos(A), sinA = sin(A);
  float cosB = cos(B), sinB = sin(B);
  // 输出字符
  char output[0..screen_width, 0..screen_height] = &#39; &#39;;
  // 2D屏幕上的点原来在3D物体上的z坐标记录
  float zbuffer[0..screen_width, 0..screen_height] = 0;

  // 且面圆上的点
  for (float theta=0; theta &lt; 2*pi; theta += theta_spacing) {
    // 预先计算 theta 的sin和cos
    float costheta = cos(theta), sintheta = sin(theta);

    // 旋转体 ,上面的圆绕旋转轴旋转phi
    for(float phi=0; phi &lt; 2*pi; phi += phi_spacing) {
      // 同样预先计算 phi 的 sin和cos
      float cosphi = cos(phi), sinphi = sin(phi);

      // 绕y轴旋转前 圆上的点 的 x,y
      float circlex = R2 + R1*costheta;
      float circley = R1*sintheta;

      // 计算出最终的 3D (x,y,z) 坐标, 上面公式是想对于旋转中心,这里z加上K2 表示相对于人的眼睛的
      float x = circlex*(cosB*cosphi + sinA*sinB*sinphi)
        - circley*cosA*sinB; 
      float y = circlex*(sinB*cosphi - sinA*cosB*sinphi)
        + circley*cosA*cosB;
      float z = K2 + cosA*circlex*sinphi + circley*sinA;
      float ooz = 1/z;  // &quot;one over z&quot;

      // 计算在屏幕上的x和y,因为是屏幕上原点要移动到 屏幕中心, 至此有了2D上的位置
      int xp = (int) (screen_width/2 + K1*ooz*x);
      int yp = (int) (screen_height/2 - K1*ooz*y);

      // 计算光照
      float L = cosphi*costheta*sinB - cosA*costheta*sinphi -
        sinA*sintheta + cosB*(cosA*sintheta - costheta*sinA*sinphi);
      // 因为选取的光的模长度sqrt2, 所以光强度[-sqrt2,sqrt2]之间, 小于零的视作在背面直接看不见
      if (L &gt; 0) {
        // 检查z级别, z越小ooz越大,离人越近,覆盖优先级更高
        if(ooz &gt; zbuffer[xp,yp]) {
          zbuffer[xp, yp] = ooz;
          int luminance_index = L*8;
          // luminance_index 现在范围是 0..11 (8*sqrt(2) = 11.3)
          // 因此字符映射如下
          output[xp, yp] = &quot;.,-~:;=!*#$@&quot;[luminance_index];
        }
      }
    }
  }
  // 最后输出output到屏幕即可
  // 在终端里 控制光标到终端的起始,可以重用屏幕输出
  printf(&quot;\x1b[H&quot;);
  for (int j = 0; j &lt; screen_height; j++) {
    for (int i = 0; i &lt; screen_width; i++) {
      putchar(output[i,j]);
    }
    putchar(&#39;\n&#39;);
  }
}
</code></pre>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p><code>index.html</code></p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;header&gt;
        &lt;title&gt;donut.js&lt;/title&gt;
        &lt;script type=&quot;text/javascript&quot; async=&quot;&quot; src=&quot;./index.js&quot;&gt;&lt;/script&gt;
    &lt;/header&gt;
    &lt;body&gt;
        &lt;div&gt;
            &lt;button onclick=&quot;anim1();&quot;&gt;toggle animation&lt;/button&gt;
            &lt;pre id=&quot;d&quot; style=&quot;background-color:#000; color:#ccc; font-size: 10pt;&quot;&gt;&lt;/pre&gt;
            &lt;button onclick=&quot;anim2();&quot;&gt;toggle animation&lt;/button&gt;
        &lt;canvas id=&quot;canvasdonut&quot; width=&quot;300&quot; height=&quot;240&quot;&gt;&lt;/canvas&gt;
            &lt;button onclick=&quot;anim3();&quot;&gt;toggle animation&lt;/button&gt;
        &lt;canvas id=&quot;canvascube&quot; width=&quot;300&quot; height=&quot;240&quot;&gt;&lt;/canvas&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><code>index.js</code>:</p>
<pre><code class="js">(function() {
let _onload = () =&gt; {
  let pretag = document.getElementById(&#39;d&#39;);
  let canvastag = document.getElementById(&#39;canvasdonut&#39;);
  let canvascube = document.getElementById(&#39;canvascube&#39;);

  let tmr1 = undefined;
  let tmr2 = undefined;

  // This is copied, pasted, reformatted, and ported directly from my original
  // donut.c code
  let asciiframe= ((A,B) =&gt; () =&gt; {
    let b=[];
    let z=[];
    A += 0.07;
    B += 0.03;
    let cA=Math.cos(A), sA=Math.sin(A),
        cB=Math.cos(B), sB=Math.sin(B);
    for(let k=0;k&lt;1760;k++) {
      b[k]= k%80 == 79 ? &quot;\n&quot; : &quot; &quot;;
      z[k]= 0;
    }
    for(let j=0;j&lt;6.28;j+=0.07) { // j &lt;=&gt; theta
      let ct=Math.cos(j),st=Math.sin(j);
      for(i=0;i&lt;6.28;i+=0.02) {   // i &lt;=&gt; phi
        let sp=Math.sin(i),cp=Math.cos(i),
            h=ct+2, // R1 + R2*cos(theta)
            D=1/(sp*h*sA+st*cA+5), // this is 1/z
            t=sp*h*cA-st*sA; // this is a clever factoring of some of the terms in x&#39; and y&#39;

        let x=0|(40+30*D*(cp*h*cB-t*sB)),
            y=0|(12+15*D*(cp*h*sB+t*cB)),
            o=x+80*y,
            N=0|(8*((st*sA-sp*ct*cA)*cB-sp*ct*sA-st*cA-cp*ct*sB));
        if(y&lt;22 &amp;&amp; y&gt;=0 &amp;&amp; x&gt;=0 &amp;&amp; x&lt;79 &amp;&amp; D&gt;z[o]) {
          z[o]=D;
          b[o]=&quot;.,-~:;=!*#$@&quot;[N&gt;0?N:0];
        }
      }
    }
    pretag.innerHTML = b.join(&quot;&quot;);
  })(Math.random()*Math.PI,Math.random()*Math.PI);

  window.anim1 = () =&gt; {
    if(tmr1 === undefined) {
      tmr1 = setInterval(asciiframe, 50);
    } else {
      clearInterval(tmr1);
      tmr1 = undefined;
    }
  };

  // This is a reimplementation according to my math derivation on the page
  let canvasframe = ((A,B) =&gt; (R1,R2,K1,K2,rA,rB) =&gt; {
    let ctx = canvastag.getContext(&#39;2d&#39;);
    ctx.fillStyle=&#39;#000&#39;;
    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

    A += rA*(Math.random()+0.5);
    B += rB*(Math.random()+0.5);
    // precompute cosines and sines of A, B, theta, phi, same as before
    let cA=Math.cos(A), sA=Math.sin(A),
        cB=Math.cos(B), sB=Math.sin(B);
    for(let j=0;j&lt;6.28;j+=0.3) { // j &lt;=&gt; theta
      let ct=Math.cos(j),st=Math.sin(j); // cosine theta, sine theta
      for(i=0;i&lt;6.28;i+=0.1) {   // i &lt;=&gt; phi
        let sp=Math.sin(i),cp=Math.cos(i); // cosine phi, sine phi
        let ox = R2 + R1*ct, // object x, y = (R2,0,0) + (R1 cos theta, R1 sin theta, 0)
            oy = R1*st;

        let x = ox*(cB*cp + sA*sB*sp) - oy*cA*sB; // final 3D x coordinate
        let y = ox*(sB*cp - sA*cB*sp) + oy*cA*cB; // final 3D y
        let ooz = 1/(K2 + cA*ox*sp + sA*oy); // one over z
        let xp=(150+K1*ooz*x); // x&#39; = screen space coordinate, translated and scaled to fit our 320x240 canvas element
        let yp=(120-K1*ooz*y); // y&#39; (it&#39;s negative here because in our output, positive y goes down but in our 3D space, positive y goes up)
        // luminance, scaled back to 0 to 1
        let L=0.7*(cp*ct*sB - cA*ct*sp - sA*st + cB*(cA*st - ct*sA*sp));
        if(L &gt; 0) {
          ctx.fillStyle = `rgba(255,255,255,${L}`;
          ctx.fillRect(xp, yp, 10*L, 10*L);
        }
      }
    }
  })(Math.random()*Math.PI,Math.random()*Math.PI);

  window.anim2 = () =&gt; {
    if(tmr2 === undefined) {
      tmr2 = setInterval(() =&gt; canvasframe(1,2,150,5,0.07,0.03), 50);
    } else {
      clearInterval(tmr2);
      tmr2 = undefined;
    }
  };

  // Cube
  let canvasframe2 = ((A,B) =&gt; (W,K1,K2,rA,rB,sX,sY) =&gt; {
    let ctx = canvascube.getContext(&#39;2d&#39;);
    ctx.fillStyle=&#39;#000&#39;;
    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

    A += rA*(Math.random()+0.5);
    B += rB*(Math.random()+0.5);
    // precompute cosines and sines of A, B, theta, phi, same as before
    let cA=Math.cos(A), sA=Math.sin(A),
        cB=Math.cos(B), sB=Math.sin(B);
    for(let j=-W/2;j&lt;W/2;j+=0.2) { // j &lt;=&gt; theta
      for(i=-W/2;i&lt;W/2;i+=0.2) {   // i &lt;=&gt; phi
        for(z=-W/2;z&lt;W/2;z+=0.2){ // (j,i,z)
          let x = j*cB - z*sA*sB - i*cA*sB; // final 3D x coordinate
          let y = j*sB + z*cB*sA + i*cA*cB; // final 3D y
          let ooz = K1/(K2 - z*cA + i*sA); // one over z
          let xp=(sX/2+ooz*x); // x&#39; = screen space coordinate, translated and scaled to fit our 320x240 canvas element
          let yp=(sY/2-ooz*y); // y&#39; (it&#39;s negative here because in our output, positive y goes down but in our 3D space, positive y goes up)
          // luminance, scaled back to 0 to 1
          let L=(y + W/2 + (z*cA - i*sA)+W/2)/(2*W);
          if(L &gt; 0) {
            ctx.fillStyle = `rgba(255,255,255,${L}`;
            ctx.fillRect(xp, yp, 10*L, 10*L);
          }
        }
      }
    }
  })(Math.random()*Math.PI,Math.random()*Math.PI);

  window.anim3 = ((tmr)=&gt; () =&gt; {
    if(tmr === undefined) {
      tmr = setInterval(() =&gt; canvasframe2(1,300,5,0.07,0.03,300,240), 50);
    } else {
      clearInterval(tmr);
      tmr = undefined;
    }
  })();


  window.anim1();
  window.anim2();
  window.anim3();
}

if(document.all)
  window.attachEvent(&#39;onload&#39;,_onload);
else
  window.addEventListener(&quot;load&quot;,_onload,false);
})();
</code></pre>
<h2 id="去掉数学库"><a href="#去掉数学库" class="headerlink" title="去掉数学库"></a>去掉数学库</h2><p><a href="https://www.youtube.com/watch?v=DEqXNfs_HhY" target="_blank" rel="noopener">Lex Fridman Youtube</a></p>
<p><a href="https://www.youtube.com/watch?v=sW9npZVpiMI" target="_blank" rel="noopener">Joma Tech</a></p>
<p>早知道会受到这么多关注,我就会在它上面花更多时间</p>
<p>对于程序中来说,<code>sin</code>,<code>cos</code>这两个函数消耗最大,并且需要<code>-lm</code></p>
<p>既然有旋转公式,那么</p>
<p>$\begin{bmatrix} c’ \\ s’ \end{bmatrix} = \begin{bmatrix} \cos \theta &amp; -\sin \theta \\ \sin \theta &amp; \cos \theta \end{bmatrix} \begin{bmatrix} c \\ s \end{bmatrix}$</p>
<p>可以每次旋转一度,来完成转换,而不是计算<code>sin/cos</code>, 我们只需要硬编码<code>sin(2pi/314),cos(2pi/314)</code> 即可</p>
<pre><code class="c">float c=1, s=0;  // c for cos, s for sin
for (int i = 0; i &lt; 314; i++) {  // 314 * .02 ~= 2π
  // (use c, s in code)
  float newc = 0.9998*c - 0.019998666*s;
  s = 0.019998666*c + 0.9998*s;
  c = newc;
}
</code></pre>
<p>然而如果如此做下去,会出现误差累积(不论多少精度),最终导致不是个圆形</p>
<p><img src="https://www.a1k0n.net/img/sincos-mag.png" alt="误差累积后"></p>
<p>一个思路是每次单位化结果.但如果直接去根号,那还是需要数学库,这一块可以用牛顿切线,不论是直接处理根号,还是根号分之1, 即使没有牛顿切的知识,二分也是类似的思路,就是手动实现开根</p>
<p>不过这里 作者说只做一步牛顿切,觉得它足够接近1</p>
<h2 id="CORDIC"><a href="#CORDIC" class="headerlink" title="CORDIC"></a>CORDIC</h2><ol>
<li>提取cos</li>
</ol>
<p>$\begin{bmatrix} c’ \\ s’ \end{bmatrix} = \frac{1}{\cos \theta}\begin{bmatrix} 1 &amp; -\tan \theta \\ \tan \theta &amp; 1 \end{bmatrix} \begin{bmatrix} c \\ s \end{bmatrix}$</p>
<ol start="2">
<li>cos足够接近1, 我们甚至可以省略它,直接只用tan的部分加上牛顿切</li>
</ol>
<p>其中t 是 tan, 宏编程</p>
<pre><code class="c">#define R(t,x,y) \
  f = x; \
  x -= t*y; \
  y += t*f; \
  f = (3-x*x-y*y)/2; \
  x *= f; \
  y *= f;
</code></pre>
<h2 id="去掉float"><a href="#去掉float" class="headerlink" title="去掉float"></a>去掉float</h2><p>We can use exactly the same ideas with integer fixed-point arithmetic, and not use any float math whatsoever. I’ve redone all the math with 10-bit precision and produced the following C code which runs well on embedded devices which can do 32-bit multiplications and have ~4k of available RAM:</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>本身上数学难度算不高,但是涉及了不少现有技术的基础,如3D到2D,光照计算,3D物体旋转,ASCII亮度表现法</li>
<li>混乱后的代码看上去更”有趣”,不过博主没有介绍混淆,只介绍了实现,实际上混淆方法多,用就是了.</li>
<li>基于每一步的详细解读,修改内容可以实现正方体,不同光源,的渲染,如上面代码中就有正方体的渲染</li>
</ol>
<h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><p><a href="https://www.a1k0n.net/2006/09/15/obfuscated-c-donut.html" target="_blank" rel="noopener">原文0 2006</a></p>
<p><a href="https://www.a1k0n.net/2006/09/20/obfuscated-c-donut-2.html" target="_blank" rel="noopener">原文1 2006</a></p>
<p><a href="https://www.a1k0n.net/2011/07/20/donut-math.html" target="_blank" rel="noopener">原文2 2011</a></p>
<p><a href="https://www.a1k0n.net/2021/01/13/optimizing-donut.html" target="_blank" rel="noopener">原文3 2021</a></p>
<p><a href="https://en.wikipedia.org/wiki/Z-buffering" target="_blank" rel="noopener">Z-buffering</a></p>
<p><a href="https://en.wikipedia.org/wiki/Torus" target="_blank" rel="noopener">环面 torus</a></p>
<p><a href="https://en.wikipedia.org/wiki/Solid_of_revolution" target="_blank" rel="noopener">旋转体 solid of revolution</a></p>
<p><a href="https://en.wikipedia.org/wiki/Rotation_matrix" target="_blank" rel="noopener">旋转矩阵 rotation matrix</a></p>
<p><a href="http://en.wikipedia.org/wiki/Surface_normal" target="_blank" rel="noopener">平面法线 surface normal</a></p>
<p><a href="https://en.wikipedia.org/wiki/CORDIC" target="_blank" rel="noopener">CORDIC</a></p>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                         
                            This blog is under a <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank">CC BY-NC-SA 3.0 Unported License</a>
                        </strong>
                        <br>
                        <strong>本文鏈接：</strong><a href="http://yexiaorain.github.io/Blog/2021-12-31-donut/">http://yexiaorain.github.io/Blog/2021-12-31-donut/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yexiaorain.github.io/Blog/2021-12-31-donut/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://yexiaorain.github.io/Blog/2021-12-31-donut/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>
<script type="text/ls-javascript" id="disqus-thread-script">
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//yexiaorain.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/Blog/2022-02-11-project-euler516/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/Blog/2021-12-06-ac_agc056B/" id="post_nav-older" class="next-content">
            舊篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/Blog/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/Blog/img/satan.jpg" alt="Xiao Ye's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        yexiaorain@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: yexiaorain@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/Blog/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                首頁
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    過往
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/Blog/archives/2022/06/">六月 2022<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2022/05/">五月 2022<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2022/04/">四月 2022<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2022/03/">三月 2022<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2022/02/">二月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/12/">十二月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/11/">十一月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/09/">九月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/08/">八月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/07/">七月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/06/">六月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/05/">五月 2021<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/04/">四月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2021/02/">二月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/11/">十一月 2020<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/08/">八月 2020<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/07/">七月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/06/">六月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/05/">五月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/04/">四月 2020<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/03/">三月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/02/">二月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2020/01/">一月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/11/">十一月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/10/">十月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/09/">九月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/08/">八月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/07/">七月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/06/">六月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/05/">五月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/04/">四月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/03/">三月 2019<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/02/">二月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2019/01/">一月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2018/11/">十一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2018/07/">七月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2018/06/">六月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2018/05/">五月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2018/04/">四月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/archives/2017/10/">十月 2017<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分類
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/Blog/categories/Atcoder/">Atcoder<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/CodeChef/">CodeChef<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/Codeforces/">Codeforces<span class="sidebar_archives-count">66</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/Machine-learning/">Machine learning<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/Math/">Math<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/NowCoder/">NowCoder<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/NowCoder/LCA/">LCA<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/Project-Euler/">Project Euler<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/USACO/">USACO<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/algorithm/">algorithm<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/c/">c++<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/code/">code<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/codeforce/">codeforce<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/luogu/">luogu<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/math/">math<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/Blog/categories/tencent/">tencent<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://yexiaorain.github.com" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2013&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/Blog/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/Blog/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/Blog/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- 使用 DISQUS js 代码 -->
<script id="dsq-count-scr" src="//yexiaorain.disqus.com/count.js" async></script>





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/Blog/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/Blog/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->

    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
