---
title: Atcoder abc276
date: 2022-11-05
tags: [排列组合]
category: [Atcoder,ABC]
description: G(排列组合)Ex()
---

https://atcoder.jp/contests/abc276/tasks

# G - Count Sequences

范围 [0,m] 单调递增 n个数, 且相邻 mod 3 不同

问 方案数 mod 998244353

## 范围

n 1e7

m 1e7

4s

1024mb

## 我的思路

f(n,m) = 范围 [0,m] 放n个数, 第一个放0 的方案数

ans = sum f(n,0..m)

f(n,m) = sum f(n-1,m-非3倍数)

考虑 生成函数 f(n,m) 为 生成函数$F_n$的系数

$F_1 = 1+x+x^2+x^3+\cdots = \frac{1}{1-x}$

$ans = \lbrack m \rbrack (F_n \cdot \frac{1}{1-x}) $

$F_i = F_{i-1} \cdot (x+x^2+x^4+x^5+x^7+x^8+\cdots)$

$= F_{i-1} \cdot \frac{x+x^2}{1-x^3}$

$F_n = F_1 \cdot (\frac{x+x^2}{1-x^3})^{n-1} $

$ans = \lbrack m \rbrack \frac{(x+x^2)^{n-1}}{(1-x)^2(1-x^3)^{n-1}}$

然后 我暴力算 样例就TLE了

## 题解

令 b1=a1, 其它的为相邻ai的差, 那么和 <= m, b[2..]是mod 3非0的数

每个bi考虑把它分成两部分

3的倍数的部分 y 和 mod3 的部分x

x的部分就是 第一个 0,1,2, 后面的1,2 

sum y <= (m - sum x)/3

y 就是小球插球法, 可以均摊O(1), 

(n个非负数 和小于等于s, 不妨设s-这些数的和为最后一个数, 就是n+1个非负数和为s, n+1个正数 和为s+n+1, s+n个空隙插入n个板子 binom(s+n,n)

然后 x的和 的出现次数 可以类似排列组合就没了

和为s

0 + n-1个(1,2) = [n-1..2(n-1)] = binom(n-1,s-(n-1))

1 + n-1个(1,2) = [n..2(n-1)+1] = binom(n-1,s-1-(n-1))

2 + n-1个(1,2) = [n+1..2(n-1)+2] = binom(n-1,s-2-(n-1))

## 代码

https://atcoder.jp/contests/abc276/submissions/36273738

```cpp
#include <bits/stdc++.h>
#include <atcoder/modint>
#include <atcoder/convolution>
const int MOD = 998244353;
using mint = atcoder::static_modint<MOD>;

#define rep(i,a,n) for (int i=a;i<(int)n;i++)
#define per(i,a,n) for (int i=n;i-->(int)a;)

int read(){int r;scanf("%d",&r);return r;}

const int N=14000000;
mint fac[N+10]={1};
mint ifac[N+10];
mint binom(int n,int m){return (m>n||m<0)?0:(fac[n]*ifac[m]*ifac[n-m]);}

int main(){
  rep(i,1,N+1) fac[i]=fac[i-1]*i;
  ifac[N]=fac[N].inv();
  per(i,0,N) ifac[i]=ifac[i+1]*(i+1);

  int n=read();
  int m=read();
  mint ans =0;

  rep(s12,0,m+1){ // mod part
    mint s=0;
    rep(fi,0,3) s+=binom(n-1,s12-fi-(n-1));
    ans += s*binom(n+(m-s12)/3,n);
  }
  printf("%d\n",ans.val());
  return 0;
}
```

# 总结

G

不会数数...哎

其实1e7基本注定了连 n log n都是不行的, 要么就是 O(n) 要么就是数学怎么搞一搞 O(1)或者O(log n)

Ex

# 参考

[官方题解](https://atcoder.jp/contests/abc276/editorial)

