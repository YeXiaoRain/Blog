---
title: Atcoder abc281
date: 2022-12-11
tags: [DP,TODO]
category: [Atcoder,ABC]
description: G(DP)Ex(TODO)
---

https://atcoder.jp/contests/abc281/tasks

# G - Farthest CIty

问 n个点, 的简单连通图, 1到n的距离 严格大于所有1到其它点的距离的 图有多少个

个数 mod m

## 范围

n 500

m [1e8,1e9]

4s

1024mb

## 我的思路

数数嘛, 对于一个具体的图, 考虑计算所有点到1的距离,看一下相邻点的性质, 

显然 相邻点的`距离`值 差不大于1

所以有一个O(n^4) 的dp

`dp[最大距离为i][距离为i的有j个][距离<=i的有k个] = 的方案数`

有转移 `dp[i][j0][k0] = dp[i-1][j1][k1] * binom(n-k1,j0)/j0个在剩下的中选/ * (2^(j1)-1)^j0(每个分别和前面j1的连接方式) * 2^(j0(j0-1)/2) (j0个内部的任意连接) , 其中 k0=k1+j0`

这样答案就是 `sum dp[1..n][1][n]`

要是能优化成O(n^3)就能过了, 比赛时想了半天, 发现i无关, 想说矩阵乘法快速幂次, binom拆一拆 搞了半天

---

赛后又想了想, 可以完全不要 `i` 直接 `dp[用了k个点][最大距离的有j个点]`的方案数 就完了....................

`dp[i0][j0] = dp[i1][j1] * binom(n-i1,j0) * (2^{j1}-1)^j0 * 2^(j0(j0-1)/2), 其中 i0=i1+j0`

`ans=dp[n][1]`

其实这里有点问题, 因为中间选的时候不能选择 最后一个

所以不妨 先把 n拿出来 最后考虑它

这样转移方程不变

`ans= sum dp[n-1][j=1..n-1] * (2^j-1)`

---

然后加个预处理 去掉 中间的log复杂度

## 代码

https://atcoder.jp/contests/abc281/submissions/37193246

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
#define rep(i,a,n) for (ll i=a;i<(ll)n;i++)

ll read(){ll r;scanf("%lld",&r);return r;}

ll dp[510][510]; // dp[用i个点][最大距离有j个点]
ll binom[510][510];
ll p2[250010]={1};
ll cache[510][510]; // cache[i][j] = (2^i-1)^j

int main(){
  ll n=read(); // 500 n 点, 简单无向 联通图, 1-n严格长于1-其它
  ll m=read(); // 1e8~1e9
  rep(i,0,501) binom[i][i]=binom[i][0]=1;
  rep(i,1,501) rep(j,1,i) binom[i][j]=(binom[i-1][j]+binom[i-1][j-1])%m;
  rep(i,1,250001) p2[i]=p2[i-1]*2%m;
  rep(i,1,501) {
    cache[i][0]=1;
    ll base=p2[i]-1;
    rep(j,1,501) cache[i][j]=cache[i][j-1]*base%m;
  }
  dp[1][1] = 1;
  rep(i,1,n) rep(j,1,i+1) if(dp[i][j]) rep(j1,1,n) if(i+j1<=n-1){ // 最后一个先不考虑, (i,j) => (i+j1,j1)
    (dp[i+j1][j1] += dp[i][j]
     *binom[n-1-i][j1]%m
     *cache[j][j1]%m
     *p2[j1*(j1-1)/2]%m )%=m;
  }
  ll ans=0;
  rep(i,1,n-1) (ans+=dp[n-1][i]*(p2[i]-1)%m)%=m;
  printf("%lld\n",ans);
  return 0;
}
```

# 总结

G

没啥难的

这... 为啥会多想一个维度, 哎 太菜了

Ex


# 参考

[官方题解](https://atcoder.jp/contests/abc281/editorial)
